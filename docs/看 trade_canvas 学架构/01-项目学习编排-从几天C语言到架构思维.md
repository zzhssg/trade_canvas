---
title: 第1关：项目学习编排（从几天 C 语言到架构思维）
status: done
created: 2026-02-11
updated: 2026-02-11
---

# 第1关：项目学习编排（从几天 C 语言到架构思维）

目标很直接：不是“把代码看完”，而是建立一套你以后做任何系统都能复用的脑内框架。

你现在最该学的，不是更多语法，而是四个能力：

1. 看清边界（系统里谁该做什么）。
2. 跟踪主链路（数据怎么流，状态怎么变）。
3. 理解不变量（什么绝不能被破坏）。
4. 设计可回滚变更（怎么改才不会把系统炸穿）。

---

## 1. 先建立“系统地图”，别一上来钻函数

trade_canvas 的主线可以先记成一句话：

`closed candle` 是权威输入，同一输入同时驱动 ledger（策略真源）和 overlay（图表输出），保证同输入同输出。

这一句背后有三个关键边界：

- `closed` 进计算链；`forming` 只用于展示。
- 写侧用增量推进，不允许有产物时全量重算。
- 读侧拿的是“历史 + 头部快照”，不是临时拼凑。

先把这三条刻进脑子，后面所有代码就不再是碎片。

---

## 2. 用“写侧闭环”理解后端架构，而不是看目录

推荐第一条主链路（写侧）：

1. `IngestPipeline` 收到 candle batch。
2. `FactorOrchestrator` 规划窗口、做增量状态恢复。
3. `FactorTickExecutor` 按 DAG 顺序跑插件（pivot -> pen -> zhongshu -> anchor）。
4. `FactorStore` 以 append-only 事件落库 + head snapshot 落库。
5. `OverlayOrchestrator` 基于 factor events 产出图表指令。

这条链能帮你学会：  
“一个业务能力如何拆成管道、编排器、插件、存储、读模型”。

---

## 3. 再用“读侧闭环”理解前后端契约

第二条必看链路（读侧）：

1. `/api/factor/slices` 入口。
2. `FactorReadService` 做对齐与 freshness 保障。
3. `FactorSlicesService` 按 topo 顺序构建快照。
4. Slice 插件输出统一 `FactorSliceV1` 结构（history + head + meta）。

你会学到一个关键工程理念：  
写侧和读侧是分层的，但依赖契约必须一致（manifest 校验强制执行）。

---

## 4. 学架构一定要“术语-代码-测试”三点对拍

只读代码会很虚。最稳方法是三点对拍：

- 术语：`candle_id`、`closed/forming`、`depends_on`、`event_key`。
- 代码：找到术语对应的真实实现位置。
- 测试：找验证该规则的测试用例。

例如你要确认“拓扑顺序稳定”：

- 术语：DAG topo。
- 代码：`factor_graph.py` + `factor_tick_executor.py`。
- 测试：`backend/tests/test_factor_registry.py` 里顺序断言。

这就是从“看懂代码”走向“掌握工程事实”的分水岭。

---

## 5. 给初学者的 4 层进阶路径（可执行）

### 层 1：看懂输入输出（1-2 天）

- 只看 API 请求和响应结构，不深入算法。
- 目标：说清每个接口“吃什么、吐什么”。

### 层 2：看懂状态机（3-5 天）

- 重点看 `FactorTickState` 怎么在每 tick 被插件推进。
- 目标：能画出状态变化图（不是类图）。

### 层 3：看懂增量与重建（1 周）

- 重点看 bootstrap/rebuild/event 幂等。
- 目标：能解释“为什么它可回放、可补算、不重复写”。

### 层 4：看懂演进策略（持续）

- 学会用 feature flag、manifest、回归测试做安全迭代。
- 目标：自己能设计“可回滚”的跨模块改动方案。

---

## 6. 你最该偷师的 8 条工程方法论

- 单一权威输入（Single Source of Truth）
- 插件化装配（声明依赖 + 拓扑调度）
- 事件驱动账本（append-only + replay）
- 幂等写入（稳定 event_key + unique 约束）
- 写读分离（write path vs read model）
- fail-fast（缺契约立即失败，不隐式降级）
- feature flag 渐进发布（可开可关可回滚）
- DoD 门禁（测试、构建、证据、文档同步）

---

## 7. 代码锚点（第一轮必读）

- `backend/app/pipelines/ingest_pipeline.py`
- `backend/app/factor_orchestrator.py`
- `backend/app/factor_tick_executor.py`
- `backend/app/factor_graph.py`
- `backend/app/factor_manifest.py`
- `backend/app/factor_slices_service.py`
- `backend/app/factor_store.py`
- `backend/app/runtime_flags.py`

---

## 8. 过关标准（你现在就能自测）

如果你能独立回答下面 5 个问题，说明第 1 关过了：

1. 为什么 `forming` 不能进因子引擎？
2. 为什么插件要声明 `depends_on`，不能靠手工顺序？
3. 为什么事件表要 append-only，还要配 head snapshot？
4. 为什么读侧也要按 topo 顺序构建 snapshot？
5. 为什么 feature flag 是架构能力，不只是开关？
