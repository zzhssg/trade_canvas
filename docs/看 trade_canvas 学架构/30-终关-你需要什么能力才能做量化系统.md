---
title: 第30关：终关——你需要什么能力才能做量化系统
status: done
created: 2026-02-11
updated: 2026-02-11
---

# 第30关：终关——你需要什么能力才能做量化系统

上一关你看了"这个项目是怎么从 0 长到 1 的"。这一关是终关：

**通关 30 关之后，你到底学到了什么？还缺什么？接下来该怎么走？**

很多人学完一套教程后的感觉是"好像都懂了，但让我自己做又不知道从哪开始"。

这一关不讲新知识，而是帮你把前 29 关的能力串成一张地图——让你知道自己站在哪里，下一步该往哪走。

---

## 0. 先给一句总纲

做量化系统需要五层能力，像金字塔一样逐层叠加：

1. **编程基础**：能写代码、能调试、能读别人的代码
2. **领域知识**：懂 K 线、时间框架、因子、回测的基本概念
3. **系统设计**：能把需求拆成模块、定义边界、设计数据流
4. **工程纪律**：能用测试守住设计、用开关控制风险、用契约对齐前后端
5. **架构演进**：能在系统持续迭代中保持结构不退化

每一层都以下一层为基础。跳层学习就像盖楼跳过承重层——迟早塌。

---

## 1. 第一层：编程基础（第 0-3 关）

这一层你在通关前就应该具备：

- 能用 Python / TypeScript 写完整程序；
- 能读懂别人的代码，理解函数调用链；
- 能用 git 管理代码，能跑测试。

**自检**：如果你看到 `async def` 或 `TypeScript generics` 还会发懵，先补这一层。

**对应关卡**：第 0-3 关（世界观建立、术语卡、学习路径）帮你建立了"系统是什么"的直觉，但编程基础本身需要在通关前就准备好。

---

## 2. 第二层：领域知识（第 4-6 关）

量化系统不是通用 CRUD——你必须懂业务：

- **K 线与时间框架**：什么是 candle_time、open_time、close？1m 和 15m 的关系是什么？
- **因子与信号**：pivot、pen、zhongshu 分别在识别什么？它们之间的依赖关系是什么？
- **回测与回放**：为什么回测是量化的命根子？replay 和 live 的口径为什么必须一致？

**自检**：如果有人问你"为什么 forming candle 不能进因子引擎"，你能用三句话讲清楚吗？

**对应关卡**：第 4 关（K 线语言）、第 5 关（缠论三层）、第 6 关（回测）。

---

## 3. 第三层：系统设计（第 7-16 关）

这是本系列的核心地带——从"会写代码"到"会设计系统"：

- **插件架构**（第 7-8 关）：怎么让因子可扩展、可组合？
- **可复现性**（第 9 关）：幂等、bootstrap、fingerprint 三件套。
- **故障隔离**（第 10 关）：IngestPipeline 的补偿与回滚。
- **实时摄取**（第 11-12 关）：WS 调度、缺口修复、tail coverage。
- **读模型**（第 13 关）：冷热账本、定点切片、一致性检查。
- **前后端契约**（第 14-16 关）：API 契约、WS 协议、回放包。

**自检**：如果让你从零设计一条"数据摄取 → 因子计算 → 图表渲染"的链路，你能画出数据流图并标注每个模块的职责边界吗？

---

## 4. 第四层：工程纪律（第 17-28 关）

系统设计解决"怎么搭"，工程纪律解决"怎么不塌"：

- **前端状态管理**（第 17-20 关）：Zustand 三层状态、实时数据流、图表渲染、功能开关。
- **控制面装配**（第 21-22 关）：RuntimeFlags、Container、依赖注入。
- **可回滚治理**（第 23-24 关）：ServiceError 分层、kill-switch、错误可观测。
- **幂等与补偿**（第 25 关）：失败后安全恢复的三件套。
- **成本护栏**（第 26 关）：窗口化、增量化、版本化重建。
- **测试守住设计**（第 27 关）：边界护栏、语义护栏、链路护栏、演进护栏。
- **数据库取舍**（第 28 关）：三库分离、upsert vs append-only vs 版本化。

**自检**：如果线上出了 bug，你的"最短止血路径"是什么？是改代码重新部署，还是关一个开关？

---

## 5. 第五层：架构演进（第 29 关）

这是金字塔的顶层——不是"设计一个好架构"，而是"让架构在持续迭代中不退化"：

- 知道什么时候该重构，什么时候不该；
- 知道约束要先于抽象；
- 知道每一步改动都要可回滚、可验证。

**自检**：如果团队要加一个全新的因子类型，你需要改哪些文件？如果答案超过 3 个，说明插件化还不够。

---

## 6. 三条学习路径

不同背景的人，进入量化系统的路径不同：

### 路径 A：算法背景 → 系统能力

你已经懂 K 线、因子、回测，但系统设计薄弱。

建议顺序：第 7-12 关（后端核心链路）→ 第 21-27 关（架构治理）→ 第 28-29 关（数据库与演进）。

重点补：IngestPipeline 的编排思想、读写分离、边界测试。

### 路径 B：后端背景 → 量化领域

你已经懂系统设计，但不懂量化业务。

建议顺序：第 4-6 关（量化入门）→ 第 7-9 关（因子链路）→ 第 13-16 关（读模型与契约）。

重点补：closed/forming 边界、因子 DAG、replay 协议。

### 路径 C：前端背景 → 全栈量化

你已经懂 React/TypeScript，但后端和量化都不熟。

建议顺序：第 4-6 关（量化入门）→ 第 17-20 关（前端架构）→ 第 14-16 关（前后端契约）→ 第 7-12 关（后端链路）。

重点补：WS 协议、状态管理、图表渲染与后端数据流的对接。

---

## 7. 五个常见误区

### 误区 1："先把算法写对，架构以后再说"

算法正确只是第一步。没有架构护栏的算法，在迭代中会悄悄变形——今天跑对了，下周改了个不相关的模块，结果就不对了。

### 误区 2："用最新最酷的技术栈"

trade_canvas 用的是 SQLite + FastAPI + React——都不是最新最酷的。但它们在当前规模下是最简单、最可控的选择。技术选型的标准不是"酷不酷"，而是"在当前规模下，哪个方案的总成本最低"。

### 误区 3："一上来就微服务"

单人项目拆微服务，等于给自己加了 10 倍的部署和调试成本，换来的"可扩展性"在当前规模下完全用不上。

### 误区 4："测试是写完功能后补的"

测试不是"保险"，是"设计约束"。边界测试应该在写功能之前就定好——先画安检门，再让人通过。

### 误区 5："重构就是重写"

重构是在保持外部行为不变的前提下改善内部结构。trade_canvas 的五个演进阶段，没有一次是"推倒重来"——每次都是在已有基础上加一层年轮。

---

## 8. 通关之后

如果你认真通关了这 30 关，你现在应该具备：

- 看到一个系统时，能快速识别它的数据流、状态边界、写链路和读链路；
- 设计新系统时，知道先定约束、再串链路、再分读写、最后加护栏；
- 遇到线上问题时，能在 5 分钟内判断是输入错、状态错、容量错还是内部错；
- 做架构决策时，能说清楚"为什么选这个方案"而不是"因为大家都这么做"。

这些能力不只适用于量化系统——支付、任务调度、实时数据处理、IoT，底层的架构思维是通用的。

---

## 9. 最后一道自测题

不是 5 道，就 1 道：

**如果让你从零开始，用 3 个月做一个"能跑实盘的量化交易工作台"，你会怎么规划这 3 个月？**

- 第一个月做什么？
- 哪些决策必须在第一周就定下来？
- 哪些东西可以先不做？
- 你会在什么时候引入测试？
- 你会在什么时候做第一次重构？

如果你能用 10 分钟把这个计划讲清楚，恭喜你——你已经具备了量化系统架构师的基本素养。

---

30 关通关。去写你自己的系统吧。
